<?php
    $userManager = new UserManager();
    $messageManager = new MessageManager();
    $reviewManager = new ReviewManager();
    $infoManager = new InfoManager();
    $templateManager = new TemplateManager();
    // $quotationManager = new QuotationManager();
    // $imageManager = new ImageManager();
    // $categoryManager = new CategoryManager();
    // $appointmentManager = new AppointmentManager();
?>

<aside class="left-pannel">
    <ul>
        <li>
            <a href="#" id="users-link">Users</a>
            <a href="#" id="messages-link">Messages</a>
            <a href="#" id="templates-link">Templates</a>
            <a href="#" id="reviews-link">Reviews</a>
        </li>
    </ul>
</aside>
<main class="container">
    <label for="data-selection">Rechercher par :</label>
    <select name="data-selection" id="data-selection"></select>
    <label for="searchbar">Valeur :</label> 
    <input id="searchbar" type="text" name="searchbar" placeholder="Search..">

    <table id="users-table" class="hidden">
        <thead>
            <tr>
                <th>N°</th>
                <th>username</th>
                <th>email</th>
                <th>prénom</th>
                <th>nom</th>
                <th>role</th>
            </tr>
        </thead>
        <tbody id="users-body">
            <?php
            if($userManager->getUsers())
            {
                $i = 0;
                foreach($userManager->getUsers() as $user)
                {   
                    $info = $infoManager->getInfoByUserId($user->getUserId());
            ?>
                <tr>
                    <td><a href="#" id="user <?=$i;?>"><?=$i;?></a></td>
                    <td><?=$user->getUsername();?></td>
                    <td><?=$user->getEmail();?></td>
                    <td><?=$info->getFirstName();?></td>
                    <td><?=$info->getLastName();?></td>
                    <td><?=$user->getRole();?></td>
                </tr>
            <?php
                $i++;
                }
            }
            ?>
        </tbody>
    </table>
    <table id="messages-table" class="hidden">
        <thead>
            <tr>
                <th>N°</th>
                <th>username</th>
                <th>sujet</th>
                <th>date</th>
            </tr>
        </thead>
        <tbody id="messages-body">
            <?php
            if($messageManager->getMessagesOrderedByDate())
            {
                $i = 0;
                foreach($messageManager->getMessagesOrderedByDate() as $message)
                {   
                    $user = $userManager->getUserByUserId($message->getUserId());
                    $username = $user->getUsername();
            ?>
                <tr>
                    <td><a href="#" id="message <?=$i;?>"><?=$i;?></a></td>
                    <td><?=$user->getUsername();?></td>
                    <td><?=$message->getSubject();?></td>
                    <td><?=$message->getSendDate();?></td>
                </tr>
            <?php
                $i++;
                }
            }
            ?>
        </tbody>
    </table>
    <table id="templates-table" class="hidden">
        <thead>
            <tr>
                <th>N°</th>
                <th>nom</th>
                <th>catégorie</th>
                <th>date de création</th>
                <th>date de mise à jour</th>
            </tr>
        </thead>
        <tbody id="templates-body">
            <?php
            if($templateManager->getTemplatesOrderedByCreationDate())
            {
                $i = 0;
                foreach($templateManager->getTemplatesOrderedByCreationDate() as $template)
                {   
                    $category = $categoryManager->getCategoryByCategoryId($template->getCategoryId());
            ?>
                <tr>
                    <td><a href="#" id="template <?=$i;?>"><?=$i;?></a></td>
                    <td><?=$template->getName();?></td>
                    <td><?=$template->getDescription();?></td>
                    <td><?=$template->getCreatedAt();?></td>
                    <td><?=$template->getUpdatedAt();?></td>
                </tr>
            <?php
                $i++;
                }
            }
            ?>
        </tbody>
    </table>
    <table id="reviews-table" class="hidden">
        <thead>
            <tr>
                <th>N°</th>
                <th>username</th>
                <th>date de création</th>
                <th>template</th>
            </tr>
        </thead>
        <tbody id="reviews-body">
            <?php
            if($messageManager->getMessagesOrderedByDate())
            {
                $i = 0;
                foreach($messageManager->getMessagesOrderedByDate() as $message)
                {   
                    $user = $userManager->getUserByUserId($message->getUserId());
                    $username = $user->getUsername();
            ?>
                <tr>
                    <td><a href="#" id="message <?=$i;?>"><?=$i;?></a></td>
                    <td><?=$user->getUsername();?></td>
                    <td><?=$message->getSubject();?></td>
                    <td><?=$message->getSendDate();?></td>
                </tr>
            <?php
                $i++;
                }
            }
            ?>
        </tbody>
    </table>
</main>
<script type="module" src="assets/js/dashboard.js"></script>